# ReScore

Use features calculated from comparing experimental spectra with computationally generated spectra (see [MS2PIP](https://github.com/sdgroeve/ms2pip_c)) to re-score peptide identifications using [Percolator](https://github.com/percolator/percolator/). If you are interested in reproducing the results shown in
the manuscript, please refer to the wiki directory.

> Accurate peptide fragmentation predictions allow data driven approaches to replace and improve upon proteomics search engine scoring functions. Ana S C Silva, Robbin Bouwmeester, Lennart Martens, and Sven Degroeve. _Bioinformatics_ (2019) [doi:10.1093/bioinformatics/btz383](https://doi.org/10.1093/bioinformatics/btz383)

## Prerequisites

- Python 3

  - numpy
  - pandas
  - scikit-learn
  - scipy

- [Percolator](https://github.com/percolator/percolator/) (to run the file generated by this pipeline)

### Installing

Clone this repository. This includes the submodule  [MS2PIP](https://github.com/anasilviacs/ms2pip_c/tree/7b89618f236c84aed3c171132f690556c757b6b5). To include this submodule, you must clone this repository using the `--recurse-submodules` flag:
```
git clone --recurse-submodules git://github.com/anasilviacs/rescore.git
```

Go into the folder `ms2pip_c` and run the bash script `compile.sh`. For more details, please refer to the [ms2pip_c](https://github.com/compomics/ms2pip_c) repository.

## Usage

To run the entire pipeline from the beginning, you need a spectrum file in the [MGF format](http://www.matrixscience.com/help/data_file_help.html) and a peptide list in the [PEPREC format](https://github.com/anasilviacs/ms2pip_c/tree/7b89618f236c84aed3c171132f690556c757b6b5). The file should have an additional column, `Label`, where target PSMs have a value of `1` and decoys of `-1`, and `Protein`, with the protein identifiers the PSM is associated with (this is optional for the execution of the pipeline, but likely important for posterior analysis).

Run the pipeline as follows:

```
python driver.py <mgf file> <peprec file> <config file>
```

- `<mgf file>` is the spectrum file
- `<peprec file>` is the peptide list file
- `<config file>` is json with configurations for MS2PIP. A reference file that can be adapted is included in this repository.

An example configuration file is included (`config.json`). The modifications in the `<PEPREC file>` should match the modification names in `config.json`. This file already includes several modifications, but more can be added by following the same structure.


### Output

Several intermediate files are created when the entire pipeline is ran. Their names are all built based on the `<PEPREC file>` name and are stored in that file's folder. They are the following:

- `<mgf file>_pred_and_emp.csv` is one of the outputs of MS2PIP that includes the predicted and empirical intensity for each peak;
- `<mgf file>_all_features.csv` includes all the spectral features that were calculated;
- `<mgf file>.pin` is a Percolator INput file that includes the calculated features.

`Percolator` can be ran on this file by typing:

```
percolator <pin file>
```

For more details regarding how to run Percolator please refer to its [wiki pages](https://github.com/percolator/percolator/wiki).
